name: Lock comments on closed issues

on:
  issues:
    types: [closed]
  workflow_dispatch:

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  lock_comments:
    runs-on: ubuntu-latest
    
    steps:
    - name: Install gh CLI
      run: |
        npm install -g gh
    - name: Lock comments on closed issue
      run: |
        echo "Running action to lock comments on closed issues..."
        ISSUE_NUMBER=$(echo "$GITHUB_EVENT_NAME" | cut -d "/" -f2)
        gh api \
        --method PUT \
        -H "Accept: application/vnd.github+json" \
        /repos/$GITHUB_REPOSITORY/issues/$ISSUE_NUMBER/lock \
        -H "Authorization: token $GITHUB_TOKEN" \
        -f lock_reason='resolved'
